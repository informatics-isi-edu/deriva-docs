

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>deriva.core.datapath &mdash; deriva-py 5.8 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> deriva-py
          

          
          </a>

          
            
            
              <div class="version">
                5.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">API Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../README.html">DataPath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../README.html#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../README.html#limitations">Limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../README.html#tutorials">Tutorials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../README.html#ermrest-model-management">ERMrest Model Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../README.html#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../README.html#limitations">Limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../README.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../README.html#add-table-to-schema">Add Table to Schema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../README.html#add-a-vocabulary-term-table">Add a Vocabulary Term Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../README.html#add-column-to-table">Add Column to Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../README.html#remove-a-column-from-a-table">Remove a Column from a Table</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../README.html#ermrestcatalog">ErmrestCatalog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../README.html#catalog-binding">Catalog Binding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../README.html#client-credentials">Client Credentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../README.html#high-level-api-factories">High-Level API Factories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../README.html#low-level-http-methods">Low-Level HTTP Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../README.html#http-caching">HTTP Caching</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/deriva.html">deriva package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/deriva.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/deriva.config.html">deriva.config package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.config.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.config.html#module-deriva.config.acl_config">deriva.config.acl_config module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.config.html#module-deriva.config.annotation_config">deriva.config.annotation_config module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.config.html#module-deriva.config.base_config">deriva.config.base_config module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.config.html#module-deriva.config.dump_catalog_annotations">deriva.config.dump_catalog_annotations module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.config.html#module-deriva.config">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/deriva.core.html">deriva.core package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.core.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.core.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.core.html#module-deriva.core.base_cli">deriva.core.base_cli module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.core.html#module-deriva.core.datapath">deriva.core.datapath module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.core.html#module-deriva.core.deriva_binding">deriva.core.deriva_binding module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.core.html#module-deriva.core.deriva_server">deriva.core.deriva_server module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.core.html#module-deriva.core.ermrest_catalog">deriva.core.ermrest_catalog module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.core.html#module-deriva.core.ermrest_config">deriva.core.ermrest_config module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.core.html#module-deriva.core.ermrest_model">deriva.core.ermrest_model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.core.html#module-deriva.core.hatrac_cli">deriva.core.hatrac_cli module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.core.html#module-deriva.core.hatrac_store">deriva.core.hatrac_store module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.core.html#module-deriva.core.polling_ermrest_catalog">deriva.core.polling_ermrest_catalog module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.core.html#module-deriva.core">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/deriva.transfer.html">deriva.transfer package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.transfer.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/deriva.transfer.html#module-deriva.transfer">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/deriva.html#module-deriva">Module contents</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Command Line Interfaces</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../cli/deriva-acl-config.html">deriva-acl-config</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cli/deriva-acl-config.html#using-deriva-acl-config-to-configure-acls">Using deriva-acl-config to configure ACLs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cli/deriva-acl-config.html#config-file-format">Config file format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-acl-config.html#the-groups-stanza">The groups stanza</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-acl-config.html#the-group-list-table-stanza">The group_list_table stanza</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-acl-config.html#the-acl-definitions-stanza">The acl_definitions stanza</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-acl-config.html#the-acl-bindings-stanza">The acl_bindings stanza</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-acl-config.html#the-catalog-acls-stanza">The catalog_acls stanza</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-acl-config.html#the-schema-acls-stanza">The schema_acls stanza</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-acl-config.html#the-table-acls-stanza">The table_acls stanza</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-acl-config.html#the-column-acls-stanza">The column_acls stanza</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-acl-config.html#the-foreign-key-acls-stanza">The foreign_key_acls stanza</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../cli/deriva-acl-config.html#security-considerations">Security Considerations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli/deriva-annotation-config.html">deriva-annotation-config</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cli/deriva-annotation-config.html#using-deriva-annotation-config-to-configure-annotations">Using deriva-annotation-config to configure annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cli/deriva-annotation-config.html#config-file-format">Config file format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-annotation-config.html#the-known-attributes-stanza">The <code class="docutils literal notranslate"><span class="pre">known_attributes</span></code> stanza</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-annotation-config.html#the-schema-annotations-stanza">The schema_annotations stanza</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-annotation-config.html#the-table-annotations-stanza">The table_annotations stanza</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-annotation-config.html#the-column-annotations-stanza">The column_annotations stanza</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-annotation-config.html#the-foreign-key-annotations-stanza">The foreign_key_annotations stanza</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html">deriva-hatrac-cli</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#common-options">Common options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#hostname">Hostname</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#authentication">Authentication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#namespace-operation-examples">Namespace operation examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#list">List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#create-namespace">Create Namespace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#delete-namespace">Delete Namespace</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#object-operation-examples">Object operation examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#put-an-object">Put an object</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#get-an-object">Get an object</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#delete-an-object">Delete an object</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#acl-operation-examples">ACL operation examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#get-acls">Get ACLs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#set-acls">Set ACLs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-hatrac-cli.html#delete-acls">Delete ACLs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli/deriva-download-cli.html">deriva-download-cli</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cli/deriva-download-cli.html#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cli/deriva-download-cli.html#command-line-options">Command-Line options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-download-cli.html#positional-arguments">Positional arguments:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../cli/deriva-download-cli.html#host"><code class="docutils literal notranslate"><span class="pre">&lt;host&gt;</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../cli/deriva-download-cli.html#config-file"><code class="docutils literal notranslate"><span class="pre">&lt;config</span> <span class="pre">file&gt;</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../cli/deriva-download-cli.html#output-dir"><code class="docutils literal notranslate"><span class="pre">&lt;output</span> <span class="pre">dir&gt;</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-download-cli.html#optional-arguments">Optional arguments:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../cli/deriva-download-cli.html#token"><code class="docutils literal notranslate"><span class="pre">--token</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../cli/deriva-download-cli.html#credential-file"><code class="docutils literal notranslate"><span class="pre">--credential-file</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../cli/deriva-download-cli.html#catalog"><code class="docutils literal notranslate"><span class="pre">--catalog</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../cli/deriva-download-cli.html#configuration-file-format">Configuration file format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-download-cli.html#configuration-file-element-catalog">Configuration file element: <code class="docutils literal notranslate"><span class="pre">catalog</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-download-cli.html#configuration-file-element-bag">Configuration file element: <code class="docutils literal notranslate"><span class="pre">bag</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-download-cli.html#configuration-file-element-env">Configuration file element: <code class="docutils literal notranslate"><span class="pre">env</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../cli/deriva-download-cli.html#supported-output-formats">Supported output formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cli/deriva-download-cli.html#output-format-details">Output format details</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-download-cli.html#env"><code class="docutils literal notranslate"><span class="pre">env</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-download-cli.html#csv"><code class="docutils literal notranslate"><span class="pre">csv</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-download-cli.html#json"><code class="docutils literal notranslate"><span class="pre">json</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-download-cli.html#json-stream"><code class="docutils literal notranslate"><span class="pre">json-stream</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-download-cli.html#download"><code class="docutils literal notranslate"><span class="pre">download</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cli/deriva-download-cli.html#fetch"><code class="docutils literal notranslate"><span class="pre">fetch</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">deriva-py</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../core.html">deriva.core</a> &raquo;</li>
        
      <li>deriva.core.datapath</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for deriva.core.datapath</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">urlquote</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">date</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">requests</span> <span class="k">import</span> <span class="n">HTTPError</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pandas</span> <span class="k">import</span> <span class="n">DataFrame</span> <span class="k">as</span> <span class="n">_DataFrame</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">_DataFrame</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;Logger for this module&quot;&quot;&quot;</span>

<span class="n">_system_defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RID&#39;</span><span class="p">,</span> <span class="s1">&#39;RCT&#39;</span><span class="p">,</span> <span class="s1">&#39;RMT&#39;</span><span class="p">,</span> <span class="s1">&#39;RCB&#39;</span><span class="p">,</span> <span class="s1">&#39;RMT&#39;</span><span class="p">,</span> <span class="s1">&#39;RMB&#39;</span><span class="p">}</span>
<span class="sd">&quot;&quot;&quot;Set of system default column names&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper for extending datapath with sub-types for the whole model tree.&quot;&quot;&quot;</span>
    <span class="n">kwargs2</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;schema_class&#39;</span><span class="p">:</span> <span class="n">Schema</span><span class="p">,</span>
        <span class="s1">&#39;table_class&#39;</span><span class="p">:</span> <span class="n">Table</span><span class="p">,</span>
        <span class="s1">&#39;column_class&#39;</span><span class="p">:</span> <span class="n">Column</span>
    <span class="p">}</span>
    <span class="n">kwargs2</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kwargs2</span>


<div class="viewcode-block" id="from_catalog"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.from_catalog">[docs]</a><span class="k">def</span> <span class="nf">from_catalog</span><span class="p">(</span><span class="n">catalog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a datapath.Catalog object from an ErmrestCatalog object.</span>
<span class="sd">    :param catalog: an ErmrestCatalog object</span>
<span class="sd">    :return: a datapath.Catalog object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Catalog</span><span class="p">(</span><span class="n">catalog</span><span class="o">.</span><span class="n">getCatalogSchema</span><span class="p">(),</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">(</span><span class="n">catalog</span><span class="o">=</span><span class="n">catalog</span><span class="p">))</span></div>


<span class="k">def</span> <span class="nf">_isidentifier</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tests if string is a valid python identifier.</span>
<span class="sd">    This function is intended for internal usage within this module.</span>
<span class="sd">    :param a: a string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;isidentifier&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">isidentifier</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;[_A-Za-z][_a-zA-Z0-9]*$&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">_http_error_message</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a formatted error message from the raw HTTPError.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


<div class="viewcode-block" id="DataPathException"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.DataPathException">[docs]</a><span class="k">class</span> <span class="nc">DataPathException</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;DataPath exception</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DataPathException</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="n">reason</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span></div>


<div class="viewcode-block" id="Catalog"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Catalog">[docs]</a><span class="k">class</span> <span class="nc">Catalog</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Handle to a Catalog.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_doc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates the Catalog.</span>
<span class="sd">        :param model_doc: the schema document for the catalog</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Catalog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">sname</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;schema_class&#39;</span><span class="p">,</span> <span class="n">Schema</span><span class="p">)(</span><span class="n">sname</span><span class="p">,</span> <span class="n">sdoc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sname</span><span class="p">,</span> <span class="n">sdoc</span> <span class="ow">in</span> <span class="n">model_doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;schemas&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">Catalog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span> <span class="k">if</span> <span class="n">_isidentifier</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">a</span><span class="p">]</span></div>


<div class="viewcode-block" id="Schema"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Schema">[docs]</a><span class="k">class</span> <span class="nc">Schema</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a Schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sname</span><span class="p">,</span> <span class="n">schema_doc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates the Schema.</span>
<span class="sd">        :param sname: the schema&#39;s name</span>
<span class="sd">        :param schema_doc: the schema document</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schema</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">sname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">tname</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;table_class&#39;</span><span class="p">,</span> <span class="n">Table</span><span class="p">)(</span><span class="n">sname</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">tdoc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">tname</span><span class="p">,</span> <span class="n">tdoc</span> <span class="ow">in</span> <span class="n">schema_doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tables&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">Schema</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="k">if</span> <span class="n">_isidentifier</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Schema name: &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">List of tables:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;none&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;  &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">tname</span> <span class="k">for</span> <span class="n">tname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_names</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span></div>


<div class="viewcode-block" id="DataPath"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.DataPath">[docs]</a><span class="k">class</span> <span class="nc">DataPath</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents an arbitrary data path.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">TableAlias</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path_expression</span> <span class="o">=</span> <span class="n">Root</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_uri</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">_server_uri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_instances</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># map of alias_name =&gt; TableAlias object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_identifiers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bind_table_instance</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">DataPath</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">())</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identifiers</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_instances</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span>

    <span class="nd">@context</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">TableAlias</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_instances</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_path_expression</span> <span class="o">=</span> <span class="n">ResetContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_expression</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_uri</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_expression</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_contextualized_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a path uri for the specified context.</span>
<span class="sd">        :param context: a table instance that is bound to this path</span>
<span class="sd">        :return: string representation of the path uri</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">TableAlias</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">context</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_instances</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="o">!=</span> <span class="n">context</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_uri</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ResetContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_expression</span><span class="p">,</span> <span class="n">context</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uri</span>

    <span class="k">def</span> <span class="nf">_bind_table_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Binds a new table instance into this path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">TableAlias</span><span class="p">)</span>
        <span class="n">alias</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_instances</span><span class="p">[</span><span class="n">alias</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="o">=</span> <span class="n">alias</span>
        <span class="k">if</span> <span class="n">_isidentifier</span><span class="p">(</span><span class="n">alias</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_identifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alias</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="DataPath.delete"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.DataPath.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes the entity set referenced by the data path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_expression</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Deleting: </span><span class="si">{p}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">path</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_root</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">400</span> <span class="o">&lt;=</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataPathException</span><span class="p">(</span><span class="n">_http_error_message</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span></div>

<div class="viewcode-block" id="DataPath.filter"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.DataPath.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_expression</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Filters the path based on the specified formula.</span>
<span class="sd">        :param filter_expression: should be a valid Predicate object</span>
<span class="sd">        :return: self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_expression</span><span class="p">,</span> <span class="n">Predicate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path_expression</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_expression</span><span class="p">,</span> <span class="n">filter_expression</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="DataPath.link"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.DataPath.link">[docs]</a>    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">join_type</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Links this path with another table.</span>
<span class="sd">        At present, the implementation only supports single column keys.</span>
<span class="sd">        :param right: the right hand table of the link expression</span>
<span class="sd">        :param on: an equality comparison between keys and foreign keys</span>
<span class="sd">        :param join_type: the join type of this link which may be &#39;left&#39;, &#39;right&#39;, &#39;full&#39; outer joins or &#39;&#39; for inner</span>
<span class="sd">        join link by default.</span>
<span class="sd">        :return: self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">on</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">on</span><span class="p">,</span> <span class="n">FilterPredicate</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">join_type</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">on</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">right</span><span class="o">.</span><span class="n">catalog</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root</span><span class="o">.</span><span class="n">catalog</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot link across catalogs.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">TableAlias</span><span class="p">):</span>
            <span class="c1"># Validate that alias has not been used</span>
            <span class="k">if</span> <span class="n">right</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_instances</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Table instance is already linked. &quot;</span>
                                <span class="s2">&quot;Consider aliasing it if you want to link another instance of the base table.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Generate an unused alias name for the table</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">name</span>
            <span class="n">alias_name</span> <span class="o">=</span> <span class="n">table_name</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">alias_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_instances</span><span class="p">:</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">alias_name</span> <span class="o">=</span> <span class="n">table_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="n">right</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">alias_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">on</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">on</span> <span class="o">=</span> <span class="n">right</span>

        <span class="c1"># Extend path expression</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path_expression</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_expression</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">join_type</span><span class="p">)</span>

        <span class="c1"># Bind alias and this data path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bind_table_instance</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="DataPath.entities"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.DataPath.entities">[docs]</a>    <span class="k">def</span> <span class="nf">entities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">renamed_attributes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the entity set computed by this data path.</span>
<span class="sd">        Optionally, caller may specify the attributes to be included in the entity set. The attributes may be from the</span>
<span class="sd">        current context of the path or from a linked table instance. Columns may be renamed in the output and will</span>
<span class="sd">        take the name of the keyword parameter used. If no attributes are specified, the entity set will contain whole</span>
<span class="sd">        entities of the type of the path&#39;s context.</span>
<span class="sd">        :param attributes: a list of Columns.</span>
<span class="sd">        :param renamed_attributes: a list of renamed Columns.</span>
<span class="sd">        :return: an entity set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">renamed_attributes</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">renamed_attributes</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the entity set computed by this data path from the perspective of the given &#39;context&#39;.</span>
<span class="sd">        :param attributes: a list of Columns.</span>
<span class="sd">        :param renamed_attributes: a list of renamed Columns.</span>
<span class="sd">        :param context: optional context for the entities.</span>
<span class="sd">        :return: an entity set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">TableAlias</span><span class="p">)</span>
        <span class="n">catalog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root</span><span class="o">.</span><span class="n">catalog</span>

        <span class="n">expression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_expression</span>
        <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
            <span class="n">expression</span> <span class="o">=</span> <span class="n">ResetContext</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attributes</span> <span class="ow">or</span> <span class="n">renamed_attributes</span><span class="p">:</span>
            <span class="n">expression</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">renamed_attributes</span><span class="p">)</span>
        <span class="n">base_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">fetcher</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="s1">&#39;?limit=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">limit</span> <span class="k">if</span> <span class="n">limit</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">+</span> <span class="n">opts</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Fetching &quot;</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="k">if</span> <span class="mi">400</span> <span class="o">&lt;=</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DataPathException</span><span class="p">(</span><span class="n">_http_error_message</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>

        <span class="k">return</span> <span class="n">EntitySet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_uri</span> <span class="o">+</span> <span class="n">base_path</span><span class="p">,</span> <span class="n">fetcher</span><span class="p">)</span></div>


<div class="viewcode-block" id="EntitySet"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.EntitySet">[docs]</a><span class="k">class</span> <span class="nc">EntitySet</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A set of entities.</span>
<span class="sd">    The EntitySet is produced by a path. The results may be explicitly fetched. The EntitySet behaves like a</span>
<span class="sd">    container. If the EntitySet has not been fetched explicitly, on first use of container operations, it will</span>
<span class="sd">    be implicitly fetched from the catalog.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">fetcher_fn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the EntitySet.</span>
<span class="sd">        :param uri: the uri for the entity set in the catalog.</span>
<span class="sd">        :param fetcher_fn: a function that fetches the entities from the catalog.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">fetcher_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fetcher_fn</span> <span class="o">=</span> <span class="n">fetcher_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results_doc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uri</span> <span class="o">=</span> <span class="n">uri</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results_doc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results_doc</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pandas DataFrame representation of this path.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_DataFrame</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span> <span class="o">=</span> <span class="n">_DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;&#39;pandas&#39; package not installed&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">)</span>

<div class="viewcode-block" id="EntitySet.fetch"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.EntitySet.fetch">[docs]</a>    <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetches the entities from the catalog.</span>
<span class="sd">        :param limit: maximum number of entities to fetch from the catalog.</span>
<span class="sd">        :return: self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span> <span class="k">if</span> <span class="n">limit</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetcher_fn</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># clear potentially cached state</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Fetched </span><span class="si">%d</span><span class="s2"> entities&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results_doc</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="Table"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Table">[docs]</a><span class="k">class</span> <span class="nc">Table</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a Table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sname</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">table_doc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a Table object.</span>
<span class="sd">        :param sname: name of the schema</span>
<span class="sd">        :param tname: name of the table</span>
<span class="sd">        :param table_doc: deserialized json document of the table definition</span>
<span class="sd">        :param kwargs: must include `catalog`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;catalog&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sname</span> <span class="o">=</span> <span class="n">sname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">tname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_doc</span> <span class="o">=</span> <span class="n">table_doc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column_definitions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">cdoc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;column_class&#39;</span><span class="p">,</span> <span class="n">Column</span><span class="p">)(</span><span class="n">sname</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">cdoc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cdoc</span> <span class="ow">in</span> <span class="n">table_doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;column_definitions&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">Table</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_definitions</span> <span class="k">if</span> <span class="n">_isidentifier</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_definitions</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Table name: &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">List of columns:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column_definitions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;none&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_definitions</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;the url encoded name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">urlquote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fqname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;the url encoded fully qualified name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">urlquote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sname</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">uname</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">instancename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fromname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fqname</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Always a new DataPath instance that is rooted at this table.</span>
<span class="sd">        Note that this table will be automatically aliased using its own table name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">DataPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="nd">@path</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Not allowed on base tables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Path assignment not allowed on base table objects.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_contextualized_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the path as contextualized for this table instance.</span>
<span class="sd">        Conditionally updates the context of the path to which this table instance is bound.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">uri</span>

<div class="viewcode-block" id="Table.alias"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Table.alias">[docs]</a>    <span class="k">def</span> <span class="nf">alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a table alias object.</span>
<span class="sd">        :param alias_name: a string to use as the alias name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TableAlias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Table.filter"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Table.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_expression</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contextualized_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filter_expression</span><span class="p">)</span></div>

<div class="viewcode-block" id="Table.link"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Table.link">[docs]</a>    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">join_type</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contextualized_path</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="n">join_type</span><span class="p">)</span></div>

<div class="viewcode-block" id="Table.entities"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Table.entities">[docs]</a>    <span class="k">def</span> <span class="nf">entities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">renamed_attributes</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">_entities</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">renamed_attributes</span><span class="p">)</span></div>

<div class="viewcode-block" id="Table.insert"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Table.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entities</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_system_defaults</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Inserts entities into the table.</span>
<span class="sd">        :param entities: an iterable collection of entities (i.e., rows) to be inserted into the table.</span>
<span class="sd">        :param defaults: optional, set of column names to be assigned the default expression value.</span>
<span class="sd">        :param add_system_defaults: flag to add system columns to the set of default columns.</span>
<span class="sd">        :return newly created entities.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults_enc</span> <span class="o">=</span> <span class="p">{</span><span class="n">urlquote</span><span class="p">(</span><span class="n">cname</span><span class="p">)</span> <span class="k">for</span> <span class="n">cname</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">}</span> <span class="k">if</span> <span class="n">defaults</span> <span class="k">else</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">add_system_defaults</span><span class="p">:</span>
            <span class="n">defaults_enc</span> <span class="o">|=</span> <span class="n">_system_defaults</span>

        <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/entity/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fqname</span>
        <span class="k">if</span> <span class="n">defaults_enc</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">+=</span> <span class="s2">&quot;?defaults=</span><span class="si">{cols}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">defaults_enc</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Inserting entities to path: </span><span class="si">{path}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">))</span>

        <span class="c1"># JSONEncoder does not handle general iterable objects, so we have to make sure its an acceptable collection</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="n">entities</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">entities</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">EntitySet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">uri</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">ignore</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">400</span> <span class="o">&lt;=</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataPathException</span><span class="p">(</span><span class="n">_http_error_message</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span></div>

<div class="viewcode-block" id="Table.update"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Table.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entities</span><span class="p">,</span> <span class="n">correlation</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;RID&#39;</span><span class="p">},</span> <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update entities of a table.</span>

<span class="sd">        For more information see the ERMrest protocol for the `attributegroup` interface. By default, this method will</span>
<span class="sd">        correlate the input data (entities) based on the `RID` column of the table. By default, the method will use all</span>
<span class="sd">        column names found in the first row of the `entities` input, which are not found in the `correlation` set and</span>
<span class="sd">        not defined as &#39;system columns&#39; by ERMrest, as the targets if `targets` is not set.</span>

<span class="sd">        :param entities: an iterable collection of entities (i.e., rows) to be updated in the table.</span>
<span class="sd">        :param correlation: an iterable collection of column names used to correlate input set to the set of rows to be</span>
<span class="sd">        updated in the catalog. E.g., `{&#39;col name&#39;}` or `{mytable.mycolumn}` will work if you pass a Column object.</span>
<span class="sd">        :param targets: an iterable collection of column names used as the targets of the update operation.</span>
<span class="sd">        :return: EntitySet of updated entities as returned by the corresponding ERMrest interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># JSONEncoder does not handle general iterable objects, so we have to make sure its an acceptable collection</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="n">entities</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span>

        <span class="c1"># Form the correlation keys and the targets</span>
        <span class="n">correlation_cnames</span> <span class="o">=</span> <span class="p">{</span><span class="n">urlquote</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">correlation</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">targets</span><span class="p">:</span>
            <span class="n">target_cnames</span> <span class="o">=</span> <span class="p">{</span><span class="n">urlquote</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exclusions</span> <span class="o">=</span> <span class="n">correlation_cnames</span> <span class="o">|</span> <span class="n">_system_defaults</span>
            <span class="n">target_cnames</span> <span class="o">=</span> <span class="p">{</span><span class="n">urlquote</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">urlquote</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclusions</span><span class="p">}</span>

        <span class="c1"># Form the path</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/attributegroup/</span><span class="si">{table}</span><span class="s1">/</span><span class="si">{correlation}</span><span class="s1">;</span><span class="si">{targets}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fqname</span><span class="p">,</span>
            <span class="n">correlation</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">correlation_cnames</span><span class="p">),</span>
            <span class="n">targets</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_cnames</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">entities</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">EntitySet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">uri</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">ignore</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">400</span> <span class="o">&lt;=</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataPathException</span><span class="p">(</span><span class="n">_http_error_message</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span></div></div>


<div class="viewcode-block" id="TableAlias"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.TableAlias">[docs]</a><span class="k">class</span> <span class="nc">TableAlias</span> <span class="p">(</span><span class="n">Table</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a table alias.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_table</span><span class="p">,</span> <span class="n">alias_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the table alias.</span>
<span class="sd">        :param base_table: the base table to be given an alias name</span>
<span class="sd">        :param alias_name: the alias name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base_table</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TableAlias</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">base_table</span><span class="o">.</span><span class="n">sname</span><span class="p">,</span> <span class="n">base_table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">base_table</span><span class="o">.</span><span class="n">_table_doc</span><span class="p">,</span> <span class="o">**</span><span class="n">base_table</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_table</span> <span class="o">=</span> <span class="n">base_table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">alias_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;the url encoded name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">urlquote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fqname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;the url encoded fully qualified name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_table</span><span class="o">.</span><span class="n">fqname</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">instancename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uname</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fromname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_table</span><span class="o">.</span><span class="n">fqname</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the parent path for this alias.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">DataPath</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span>

    <span class="nd">@path</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot bind a table instance that has already been bound.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">DataPath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;value must be a DataPath instance.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_contextualized_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the path as contextualized for this table instance.</span>
<span class="sd">        Conditionally updates the context of the path to which this table instance is bound.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">context</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">_contextualized_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="TableAlias.entities"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.TableAlias.entities">[docs]</a>    <span class="k">def</span> <span class="nf">entities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">renamed_attributes</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">_entities</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">renamed_attributes</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Column"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Column">[docs]</a><span class="k">class</span> <span class="nc">Column</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a column in a table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sname</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">column_doc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a Column object.</span>
<span class="sd">        :param sname: schema name</span>
<span class="sd">        :param tname: table name</span>
<span class="sd">        :param column_doc: column definition document</span>
<span class="sd">        :param kwargs: kwargs must include `table` a Table instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">assert</span> <span class="s1">&#39;table&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;table&#39;</span><span class="p">],</span> <span class="n">Table</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;table&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sname</span> <span class="o">=</span> <span class="n">sname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tname</span> <span class="o">=</span> <span class="n">tname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">column_doc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">column_doc</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">column_doc</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Column name: &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\t</span><span class="s2">Type: </span><span class="si">%s</span><span class="se">\t</span><span class="s2">Comment: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> \
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">[</span><span class="s1">&#39;typename&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;the url encoded name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">urlquote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fqname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;the url encoded fully qualified name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">fqname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uname</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">instancename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">table_instancename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">instancename</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">table_instancename</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_instancename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uname</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FilterPredicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;::null::&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FilterPredicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FilterPredicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;::lt::&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FilterPredicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;::leq::&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FilterPredicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;::gt::&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FilterPredicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;::geq::&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

<div class="viewcode-block" id="Column.regexp"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Column.regexp">[docs]</a>    <span class="k">def</span> <span class="nf">regexp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">&quot;This comparison only supports string literals.&quot;</span>
        <span class="k">return</span> <span class="n">FilterPredicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;::regexp::&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="Column.ciregexp"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Column.ciregexp">[docs]</a>    <span class="k">def</span> <span class="nf">ciregexp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">&quot;This comparison only supports string literals.&quot;</span>
        <span class="k">return</span> <span class="n">FilterPredicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;::ciregexp::&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="Column.ts"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Column.ts">[docs]</a>    <span class="k">def</span> <span class="nf">ts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">&quot;This comparison only supports string literals.&quot;</span>
        <span class="k">return</span> <span class="n">FilterPredicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;::ts::&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PathOperator"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.PathOperator">[docs]</a><span class="k">class</span> <span class="nc">PathOperator</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">PathOperator</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">Project</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot extend a path after an attribute projection&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_r</span> <span class="o">=</span> <span class="n">r</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_r</span><span class="p">,</span> <span class="n">PathOperator</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r</span><span class="o">.</span><span class="n">_path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_r</span><span class="p">,</span> <span class="n">PathOperator</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r</span><span class="o">.</span><span class="n">_mode</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;/</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="Root"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Root">[docs]</a><span class="k">class</span> <span class="nc">Root</span> <span class="p">(</span><span class="n">PathOperator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Root</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="n">r</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">fromname</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;entity&#39;</span></div>


<div class="viewcode-block" id="ResetContext"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.ResetContext">[docs]</a><span class="k">class</span> <span class="nc">ResetContext</span> <span class="p">(</span><span class="n">PathOperator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">alias</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">ResetContext</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">_r</span>  <span class="c1"># discard the previous context reset operator</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ResetContext</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">TableAlias</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alias</span> <span class="o">=</span> <span class="n">alias</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_r</span><span class="p">,</span> <span class="n">PathOperator</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/$</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_r</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alias</span><span class="o">.</span><span class="n">uname</span><span class="p">)</span></div>


<div class="viewcode-block" id="Filter"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Filter">[docs]</a><span class="k">class</span> <span class="nc">Filter</span><span class="p">(</span><span class="n">PathOperator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">formula</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Filter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">Predicate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_formula</span> <span class="o">=</span> <span class="n">formula</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_r</span><span class="p">,</span> <span class="n">PathOperator</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_r</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_formula</span><span class="p">))</span></div>


<div class="viewcode-block" id="Project"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Project">[docs]</a><span class="k">class</span> <span class="nc">Project</span> <span class="p">(</span><span class="n">PathOperator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">renamed_attributes</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Project</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">renamed_attributes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Build up the list of project attributes</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
                <span class="n">iname</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">instancename</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iname</span> <span class="o">+</span> <span class="s1">&#39;:*&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">instancename</span><span class="p">)</span>

        <span class="c1"># Extend the list with renamed attributes (i.e., &quot;out alias&quot; named)</span>
        <span class="k">for</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="n">renamed_attributes</span><span class="p">:</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">renamed_attributes</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">instancename</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_r</span><span class="p">,</span> <span class="n">PathOperator</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_r</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;attribute&#39;</span></div>


<div class="viewcode-block" id="Link"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Link">[docs]</a><span class="k">class</span> <span class="nc">Link</span> <span class="p">(</span><span class="n">PathOperator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="n">as_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">join_type</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Link</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">on</span><span class="p">,</span> <span class="n">FilterPredicate</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">on</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">as_</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">as_</span><span class="p">,</span> <span class="n">TableAlias</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">join_type</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">join_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;full&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">on</span><span class="p">,</span> <span class="n">FilterPredicate</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_on</span> <span class="o">=</span> <span class="n">on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_as</span> <span class="o">=</span> <span class="n">as_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_join_type</span> <span class="o">=</span> <span class="n">join_type</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_r</span><span class="p">,</span> <span class="n">PathOperator</span><span class="p">)</span>
        <span class="n">assign</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_as</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:=&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_as</span><span class="o">.</span><span class="n">uname</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on</span><span class="o">.</span><span class="n">fqname</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_r</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">assign</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_type</span><span class="p">,</span> <span class="n">cond</span><span class="p">)</span></div>


<div class="viewcode-block" id="Predicate"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.Predicate">[docs]</a><span class="k">class</span> <span class="nc">Predicate</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">JunctionPredicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">JunctionPredicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NegationPredicate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="FilterPredicate"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.FilterPredicate">[docs]</a><span class="k">class</span> <span class="nc">FilterPredicate</span> <span class="p">(</span><span class="n">Predicate</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lop</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">rop</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FilterPredicate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lop</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rop</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rop</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> \
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">rop</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rop</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> \
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">rop</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lop</span> <span class="o">=</span> <span class="n">lop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_op</span> <span class="o">=</span> <span class="n">op</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rop</span> <span class="o">=</span> <span class="n">rop</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rop</span><span class="p">,</span> <span class="n">Column</span><span class="p">):</span>
            <span class="c1"># The only valid circumstance for a Column rop is in a link &#39;on&#39; predicate</span>
            <span class="c1"># TODO: ultimately, this should be a Column Set equality comparison</span>
            <span class="k">return</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">)=(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lop</span><span class="o">.</span><span class="n">instancename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rop</span><span class="o">.</span><span class="n">fqname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lop</span><span class="o">.</span><span class="n">instancename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op</span><span class="p">,</span> <span class="n">urlquote</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rop</span><span class="p">)))</span></div>


<div class="viewcode-block" id="JunctionPredicate"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.JunctionPredicate">[docs]</a><span class="k">class</span> <span class="nc">JunctionPredicate</span> <span class="p">(</span><span class="n">Predicate</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">JunctionPredicate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">Predicate</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">Predicate</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="o">=</span> <span class="n">left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_op</span> <span class="o">=</span> <span class="n">op</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_right</span> <span class="o">=</span> <span class="n">right</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">)</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right</span><span class="p">)</span></div>


<div class="viewcode-block" id="NegationPredicate"><a class="viewcode-back" href="../../../api/deriva.core.html#deriva.core.datapath.NegationPredicate">[docs]</a><span class="k">class</span> <span class="nc">NegationPredicate</span> <span class="p">(</span><span class="n">Predicate</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NegationPredicate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">Predicate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_child</span> <span class="o">=</span> <span class="n">child</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;!(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, USC Information Sciences Institute, Informatics Systems Research Division.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'5.8',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>