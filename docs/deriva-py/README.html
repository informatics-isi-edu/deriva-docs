

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DataPath &mdash; DERIVA Docs 1.0.0-alpha documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="deriva package" href="api/deriva.html" />
    <link rel="prev" title="deriva-py" href="index.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> DERIVA Docs
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting to know DERIVA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About DERIVA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about.html#features">Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../framework.html">DERIVA Framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../framework.html#server-components">Server Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../framework.html#ermrest">ERMrest</a></li>
<li class="toctree-l3"><a class="reference internal" href="../framework.html#hatrac">Hatrac</a></li>
<li class="toctree-l3"><a class="reference internal" href="../framework.html#ermresolve">ERMresolve</a></li>
<li class="toctree-l3"><a class="reference internal" href="../framework.html#ioboxd">IOBoxD</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../framework.html#client-libraries">Client Libraries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../framework.html#python-apis-deriva-py">Python APIs (deriva-py)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../framework.html#javascript-libraries-ermrestjs">Javascript Libraries (ERMrestJS)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../framework.html#client-applications">Client Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../framework.html#web-interface-chaise">Web Interface (Chaise)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../framework.html#desktop-clients-deriva-qt">Desktop clients (deriva-qt)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../framework.html#commandline-clients-deriva-py">Commandline Clients (deriva-py)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Using DERIVA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../users-guide/using-chaise.html">Using the Chaise Data Browser</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users-guide/using-chaise.html#example-of-a-landing-page">Example of a landing page</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users-guide/using-chaise.html#filtering-sidebar">Filtering sidebar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users-guide/using-chaise.html#search-results-view">Search results view</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users-guide/using-chaise.html#record-page">Record page</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../users-guide/managing-data.html">Managing Data in DERIVA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users-guide/managing-data.html#desktop-guis-for-authenticating-and-uploading-data-deriva-qt">Desktop GUIs for Authenticating and Uploading Data (deriva-qt)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users-guide/managing-data.html#commandline-interface-for-interacting-with-data-deriva-py">Commandline Interface for interacting with Data (deriva-py)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users-guide/managing-data.html#datapath-module-deriva-py"><code class="docutils literal notranslate"><span class="pre">datapath</span></code> module (deriva-py)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../users-guide/managing-catalogs.html">Managing Catalogs in DERIVA</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">deriva-py</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">DataPath</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#limitations">Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tutorials">Tutorials</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ermrest-model-management">ERMrest Model Management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#limitations">Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#add-table-to-schema">Add Table to Schema</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-a-vocabulary-term-table">Add a Vocabulary Term Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-column-to-table">Add Column to Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#remove-a-column-from-a-table">Remove a Column from a Table</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ermrestcatalog">ErmrestCatalog</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#catalog-binding">Catalog Binding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#client-credentials">Client Credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="#high-level-api-factories">High-Level API Factories</a></li>
<li class="toctree-l3"><a class="reference internal" href="#low-level-http-methods">Low-Level HTTP Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#http-caching">HTTP Caching</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api/deriva.html">deriva package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/deriva.html#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/deriva.config.html">deriva.config package</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/deriva.core.html">deriva.core package</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/deriva.transfer.html">deriva.transfer package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/deriva.html#module-deriva">Module contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cli/deriva-acl-config.html">deriva-acl-config</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cli/deriva-acl-config.html#using-deriva-acl-config-to-configure-acls">Using deriva-acl-config to configure ACLs</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli/deriva-acl-config.html#config-file-format">Config file format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-acl-config.html#the-groups-stanza">The groups stanza</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-acl-config.html#the-group-list-table-stanza">The group_list_table stanza</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-acl-config.html#the-acl-definitions-stanza">The acl_definitions stanza</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-acl-config.html#the-acl-bindings-stanza">The acl_bindings stanza</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-acl-config.html#the-catalog-acls-stanza">The catalog_acls stanza</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-acl-config.html#the-schema-acls-stanza">The schema_acls stanza</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-acl-config.html#the-table-acls-stanza">The table_acls stanza</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-acl-config.html#the-column-acls-stanza">The column_acls stanza</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-acl-config.html#the-foreign-key-acls-stanza">The foreign_key_acls stanza</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cli/deriva-acl-config.html#security-considerations">Security Considerations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cli/deriva-annotation-config.html">deriva-annotation-config</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cli/deriva-annotation-config.html#using-deriva-annotation-config-to-configure-annotations">Using deriva-annotation-config to configure annotations</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli/deriva-annotation-config.html#config-file-format">Config file format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-annotation-config.html#the-known-attributes-stanza">The <code class="docutils literal notranslate"><span class="pre">known_attributes</span></code> stanza</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-annotation-config.html#the-schema-annotations-stanza">The schema_annotations stanza</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-annotation-config.html#the-table-annotations-stanza">The table_annotations stanza</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-annotation-config.html#the-column-annotations-stanza">The column_annotations stanza</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-annotation-config.html#the-foreign-key-annotations-stanza">The foreign_key_annotations stanza</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cli/deriva-hatrac-cli.html">deriva-hatrac-cli</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cli/deriva-hatrac-cli.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli/deriva-hatrac-cli.html#common-options">Common options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-hatrac-cli.html#hostname">Hostname</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-hatrac-cli.html#authentication">Authentication</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cli/deriva-hatrac-cli.html#namespace-operation-examples">Namespace operation examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-hatrac-cli.html#list">List</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-hatrac-cli.html#create-namespace">Create Namespace</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-hatrac-cli.html#delete-namespace">Delete Namespace</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cli/deriva-hatrac-cli.html#object-operation-examples">Object operation examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-hatrac-cli.html#put-an-object">Put an object</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-hatrac-cli.html#get-an-object">Get an object</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-hatrac-cli.html#delete-an-object">Delete an object</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cli/deriva-hatrac-cli.html#acl-operation-examples">ACL operation examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-hatrac-cli.html#get-acls">Get ACLs</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-hatrac-cli.html#set-acls">Set ACLs</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-hatrac-cli.html#delete-acls">Delete ACLs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cli/deriva-download-cli.html">deriva-download-cli</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cli/deriva-download-cli.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli/deriva-download-cli.html#command-line-options">Command-Line options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-download-cli.html#positional-arguments">Positional arguments:</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-download-cli.html#optional-arguments">Optional arguments:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cli/deriva-download-cli.html#configuration-file-format">Configuration file format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-download-cli.html#configuration-file-element-catalog">Configuration file element: <code class="docutils literal notranslate"><span class="pre">catalog</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-download-cli.html#configuration-file-element-bag">Configuration file element: <code class="docutils literal notranslate"><span class="pre">bag</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-download-cli.html#configuration-file-element-env">Configuration file element: <code class="docutils literal notranslate"><span class="pre">env</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cli/deriva-download-cli.html#supported-output-formats">Supported output formats</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli/deriva-download-cli.html#output-format-details">Output format details</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-download-cli.html#env"><code class="docutils literal notranslate"><span class="pre">env</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-download-cli.html#csv"><code class="docutils literal notranslate"><span class="pre">csv</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-download-cli.html#json"><code class="docutils literal notranslate"><span class="pre">json</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-download-cli.html#json-stream"><code class="docutils literal notranslate"><span class="pre">json-stream</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-download-cli.html#download"><code class="docutils literal notranslate"><span class="pre">download</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="cli/deriva-download-cli.html#fetch"><code class="docutils literal notranslate"><span class="pre">fetch</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DERIVA Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">deriva-py</a> &raquo;</li>
        
      <li>DataPath</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/deriva-py/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="datapath">
<span id="datapath"></span><h1>DataPath<a class="headerlink" href="#datapath" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">datapath</span></code> module is an interface for building ERMrest “data paths” and retrieving data from ERMrest catalogs. It
also supports data manipulation (insert, update, delete). In its present form, the module provides a limited
programmatic interface to ERMrest.</p>
<div class="section" id="features">
<span id="features"></span><h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Build ERMrest “data path” URLs with a Pythonic interface</li>
<li>Covers the essentials for data retrieval: link tables, filter on attributes, select attributes, alias tables</li>
<li>Retrieve entity sets; all or limited numbers of entities</li>
<li>Convert entity sets to Pandas DataFrames</li>
<li>Insert and update entities of a table</li>
<li>Delete entities identified by a (potentially, complex) data path</li>
</ul>
</div>
<div class="section" id="limitations">
<span id="limitations"></span><h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Only supports <code class="docutils literal notranslate"><span class="pre">entity</span></code> and <code class="docutils literal notranslate"><span class="pre">attribute</span></code> resources</li>
<li>Only supports <code class="docutils literal notranslate"><span class="pre">application/json</span></code> CONTENT-TYPE (i.e., protocol could be made more efficient)</li>
<li>The <code class="docutils literal notranslate"><span class="pre">EntitySet</span></code> interface is a thin wrapper over a dictionary of a list of results</li>
<li>Many user errors are caught by Python <code class="docutils literal notranslate"><span class="pre">assert</span></code> statements rather than checking for “invalid paramters” and throwing
custom <code class="docutils literal notranslate"><span class="pre">Exception</span></code> objects</li>
</ul>
</div>
<div class="section" id="tutorials">
<span id="tutorials"></span><h2>Tutorials<a class="headerlink" href="#tutorials" title="Permalink to this headline">¶</a></h2>
<p>See the Jupyter Notebook tutorials in the <code class="docutils literal notranslate"><span class="pre">docs/</span></code> folder.</p>
<ul class="simple">
<li><a class="reference internal" href="derivapy-datapath-example-1.html"><span class="doc">Example 1</span></a>: basic schema inspection</li>
<li><a class="reference internal" href="derivapy-datapath-example-2.html"><span class="doc">Example 2</span></a>: basic data retrieval</li>
<li><a class="reference internal" href="derivapy-datapath-example-3.html"><span class="doc">Example 3</span></a>: building simple data paths</li>
<li><a class="reference internal" href="derivapy-datapath-example-4.html"><span class="doc">Example 4</span></a>: slightly more advanced topics</li>
<li><a class="reference internal" href="derivapy-datapath-update.html"><span class="doc">Data Update Example</span></a>: examples of insert, update, and delete</li>
</ul>
<p>Now, <a class="reference internal" href="get-started.html"><span class="doc">get started</span></a>!</p>
</div>
</div>
<div class="section" id="ermrest-model-management">
<span id="ermrest-model-management"></span><h1>ERMrest Model Management<a class="headerlink" href="#ermrest-model-management" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">core.ermrest_model</span></code> module provides an interface for managing the
model (schema definitions) of an ERMrest catalog.  This library
provides an (incomplete) set of helper routines for common model
management idioms.</p>
<p>For some advanced scenarios supported by the server but not yet
supported in this library, a client may need to resort to direct usage
of the low-level <code class="docutils literal notranslate"><span class="pre">deriva.core.ermrest_catalog.ErmrestCatalog</span></code> HTTP
access layer.</p>
<div class="section" id="features">
<span id="id1"></span><h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Obtain an object hierarchy mirroring the model of a catalog or catalog snapshot.</li>
<li>Discover names of schemas, tables, and columns as well as definitions where applicable.</li>
<li>Discover names and definitions of key and foreign key constraints.</li>
<li>Discover annotations on catalog and model elements.</li>
<li>Discover policies on catalog and model elements (if sufficiently privileged).</li>
<li>Create model elements<ul>
<li>Create new schemas.</li>
<li>Create new tables.</li>
<li>Create new columns on existing tables.</li>
<li>Create new key constraints over existing columns.</li>
<li>Create new foreign key constraints over existing columns and key constraints.</li>
</ul>
</li>
<li>Delete model elements<ul>
<li>Drop schemas.</li>
<li>Drop tables.</li>
<li>Drop columns.</li>
<li>Drop key constraints.</li>
<li>Drop foreign key constraints.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="limitations">
<span id="id2"></span><h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<p>Because the model management interface mirrors a complex remote
catalog model with a hierarchy of local objects, it is possible for
the local objects to get out of synchronization with the remote
catalog and either represent model elements which no longer exist or
lack model elements recently added.</p>
<p>The provided management methods, when used carefully, can
incrementally update the local representation with changes made to the
server by the calling client. However, if other clients make
concurrent changes, it is likely that the local representation will
diverge.</p>
<p>The only robust solution to this problem is for the caller to discard
its model representation, reconstruct it to match the latest server
state, and retry whatever changes are intended.</p>
</div>
<div class="section" id="examples">
<span id="examples"></span><h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>For the following examples, we assume this common setup:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">deriva.core</span> <span class="k">import</span> <span class="n">ErmrestCatalog</span>
<span class="kn">import</span> <span class="nn">deriva.core.ermrest_model</span> <span class="k">as</span> <span class="nn">em</span>
<span class="kn">from</span> <span class="nn">deriva.core.ermrest_model</span> <span class="k">import</span> <span class="n">builtin_types</span> <span class="k">as</span> <span class="n">typ</span>


<span class="n">catalog</span> <span class="o">=</span> <span class="n">ErmrestCatalog</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">model_root</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">getCatalogModel</span><span class="p">()</span>
</pre></div>
</div>
<p>Also, when examples show keyword arguments, they illustrate a typical
override value. If omitted, a default value will apply. Many parts of
the model definition are immutable once set, but in general <code class="docutils literal notranslate"><span class="pre">comment</span></code>,
<code class="docutils literal notranslate"><span class="pre">acl</span></code>, <code class="docutils literal notranslate"><span class="pre">acl_binding</span></code>, and <code class="docutils literal notranslate"><span class="pre">annotation</span></code> attributes can be modified after
the fact through configuration management APIs.</p>
<div class="section" id="add-table-to-schema">
<span id="add-table-to-schema"></span><h3>Add Table to Schema<a class="headerlink" href="#add-table-to-schema" title="Permalink to this headline">¶</a></h3>
<p>To create a new table, you build a table definition document and pass
it to the table-creation method on the object representing an existing
schema. The various classes involved include class-methods
<code class="docutils literal notranslate"><span class="pre">define(...)</span></code> to construct the constituent parts of the table
definition:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">column_defs</span> <span class="o">=</span> <span class="p">[</span> 
  <span class="n">em</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;Col1&quot;</span><span class="p">,</span> <span class="n">typ</span><span class="o">.</span><span class="n">text</span><span class="p">),</span> 
  <span class="n">em</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;Col2&quot;</span><span class="p">,</span> <span class="n">typ</span><span class="o">.</span><span class="n">int8</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">key_defs</span> <span class="o">=</span> <span class="p">[</span>
  <span class="n">em</span><span class="o">.</span><span class="n">Key</span><span class="o">.</span><span class="n">define</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;Col1&quot;</span><span class="p">],</span> <span class="c1"># this is a list to allow for compound keys</span>
    <span class="n">constraint_names</span><span class="o">=</span><span class="p">[</span> <span class="p">[</span><span class="n">schema_name</span><span class="p">,</span> <span class="s2">&quot;My New Table_Col1_key&quot;</span><span class="p">]</span> <span class="p">],</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Col1 text values must be distinct.&quot;</span><span class="p">,</span>
    <span class="n">annotations</span><span class="o">=</span><span class="p">{},</span>
  <span class="p">)</span>
<span class="p">]</span>
<span class="n">fkey_defs</span> <span class="o">=</span> <span class="p">[</span>
  <span class="n">em</span><span class="o">.</span><span class="n">ForeignKey</span><span class="o">.</span><span class="n">define</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;Col2&quot;</span><span class="p">],</span> <span class="c1"># this is a list to allow for compound foreign keys</span>
    <span class="s2">&quot;Foreign Schema&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Referenced Table&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;Referenced Column&quot;</span><span class="p">],</span> <span class="c1"># this is a list to allow for compound keys</span>
    <span class="n">on_update</span><span class="o">=</span><span class="s1">&#39;CASCADE&#39;</span><span class="p">,</span>
    <span class="n">on_delete</span><span class="o">=</span><span class="s1">&#39;SET NULL&#39;</span><span class="p">,</span>
    <span class="n">constraint_names</span><span class="o">=</span><span class="p">[</span> <span class="p">[</span><span class="n">schema_name</span><span class="p">,</span> <span class="s2">&quot;My New Table_Col2_fkey&quot;</span><span class="p">]</span> <span class="p">],</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Col2 must be a valid reference value from the domain table.&quot;</span><span class="p">,</span>
    <span class="n">acls</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">acl_bindings</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">annotations</span><span class="o">=</span><span class="p">{},</span>
  <span class="p">)</span>
<span class="p">]</span>
<span class="n">table_def</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">define</span><span class="p">(</span>
  <span class="s2">&quot;My New Table&quot;</span><span class="p">,</span>
  <span class="n">column_defs</span><span class="p">,</span>
  <span class="n">key_defs</span><span class="o">=</span><span class="n">key_defs</span><span class="p">,</span>
  <span class="n">fkey_defs</span><span class="o">=</span><span class="n">fkey_defs</span><span class="p">,</span>
  <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;My new entity type.&quot;</span><span class="p">,</span>
  <span class="n">acls</span><span class="o">=</span><span class="p">{},</span>
  <span class="n">acl_bindings</span><span class="o">=</span><span class="p">{},</span>
  <span class="n">annotations</span><span class="o">=</span><span class="p">{},</span>
  <span class="n">provide_system</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">model_root</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span>
<span class="n">new_table</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="n">table_def</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, <code class="docutils literal notranslate"><span class="pre">create_table(...)</span></code> will add system columns to the table
definition, so the caller does not need to reconstruct these standard elements
of the column definitions nor the <code class="docutils literal notranslate"><span class="pre">RID</span></code> key definition.</p>
</div>
<div class="section" id="add-a-vocabulary-term-table">
<span id="add-a-vocabulary-term-table"></span><h3>Add a Vocabulary Term Table<a class="headerlink" href="#add-a-vocabulary-term-table" title="Permalink to this headline">¶</a></h3>
<p>A vocabulary term table is often useful to track a controlled
vocabulary used as a domain table for foreign key values used in
science data columns.  A simple vocabulary term table can be
created with a helper function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="n">model_root</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span>
<span class="n">new_vocab_table</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span>
  <span class="n">Table</span><span class="o">.</span><span class="n">define_vocabulary</span><span class="p">(</span>
    <span class="s2">&quot;My Vocabulary&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MYPROJECT:</span><span class="si">{RID}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;https://server.example.org/id/</span><span class="si">{RID}</span><span class="s2">&quot;</span>
  <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Table.define_vocabular()</span></code> method is a convenience wrapper around
<code class="docutils literal notranslate"><span class="pre">Table.define()</span></code> to automatically generate core vocabulary table
structures. It accepts other table definition parameters which a
sophisticated caller can use to override or extend these core
structures.</p>
</div>
<div class="section" id="add-column-to-table">
<span id="add-column-to-table"></span><h3>Add Column to Table<a class="headerlink" href="#add-column-to-table" title="Permalink to this headline">¶</a></h3>
<p>To create a new column, you build a column definition document and
pass it to the column-creation method on the object representing an
existing table.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">column_def</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">define</span><span class="p">(</span>
  <span class="s2">&quot;My New Column&quot;</span><span class="p">,</span>
  <span class="n">typ</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
  <span class="n">nullok</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
  <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;A string representing my new stuff.&quot;</span><span class="p">,</span>
  <span class="n">annotations</span><span class="o">=</span><span class="p">{},</span>
  <span class="n">acls</span><span class="o">=</span><span class="p">{},</span>
  <span class="n">acl_bindings</span><span class="o">=</span><span class="p">{},</span>
<span class="p">)</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">model_root</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">schema_name</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
<span class="n">new_column</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">create_column</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="n">column_def</span><span class="p">)</span>
</pre></div>
</div>
<p>The same pattern can be used to add a key or foreign key to an
existing table via <code class="docutils literal notranslate"><span class="pre">table.create_key(catalog,</span> <span class="pre">key_def)</span></code> or
<code class="docutils literal notranslate"><span class="pre">table.create_fkey(catalog,</span> <span class="pre">fkey_def)</span></code>, respectively. Similarly, a
schema can be added to a model with <code class="docutils literal notranslate"><span class="pre">model.create_schema(catalog,</span> <span class="pre">schema_def)</span></code>.</p>
</div>
<div class="section" id="remove-a-column-from-a-table">
<span id="remove-a-column-from-a-table"></span><h3>Remove a Column from a Table<a class="headerlink" href="#remove-a-column-from-a-table" title="Permalink to this headline">¶</a></h3>
<p>To delete a column, you invoke the <code class="docutils literal notranslate"><span class="pre">delete()</span></code> method on the
column object itself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">model_root</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">schema_name</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
<span class="n">column</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">column_definitions</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
<span class="n">column</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">)</span>
</pre></div>
</div>
<p>The optional <code class="docutils literal notranslate"><span class="pre">table</span></code> argument allows the method to prune the stale
object from the table object to reflect the change made on
the server. If this is omitted, the server change will be made but the
local table object will fall out of synchronization.</p>
<p>The same pattern can be used to remove a key or foreign key from a
table via <code class="docutils literal notranslate"><span class="pre">key.delete(catalog,</span> <span class="pre">table)</span></code> or <code class="docutils literal notranslate"><span class="pre">foreign_key.delete(catalog,</span> <span class="pre">table)</span></code>, respectively. Similarly, a schema or table can be removed
with <code class="docutils literal notranslate"><span class="pre">schema.delete(catalog,</span> <span class="pre">model)</span></code> or <code class="docutils literal notranslate"><span class="pre">table.delete(catalog,</span> <span class="pre">schema)</span></code>, respectively.</p>
</div>
</div>
</div>
<div class="section" id="ermrestcatalog">
<span id="ermrestcatalog"></span><h1>ErmrestCatalog<a class="headerlink" href="#ermrestcatalog" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">deriva.core.ermrest_catalog.ErmrestCatalog</span></code> class provides HTTP
bindings to an ERMrest catalog as a thin wrapper around the Python
Requests library.  Likewise, the
<code class="docutils literal notranslate"><span class="pre">deriva.core.ermrest_catalog.ErmrestSnapshot</span></code> class provides HTTP
bindings to an ERMrest catalog snapshot. While catalogs permit
mutation of stored content, a snapshot is mostly read-only and only
permits retrieval of content representing the state of the catalog at
a specific time in the past.</p>
<p>Instances of <code class="docutils literal notranslate"><span class="pre">ErmrestCatalog</span></code> or <code class="docutils literal notranslate"><span class="pre">ErmrestSnapshot</span></code> represent a
particular remote catalog or catalog snapshot, respectively. They
allow the client to perform HTTP requests against individual ERMrest
resources, but require clients to know how to formulate those
requests in terms of URL paths and resource representations.</p>
<p>Other, higher-level client APIs are layered on top of this implementation
class and exposed via factory-like methods integrated into each catalog
instance.</p>
<div class="section" id="catalog-binding">
<span id="catalog-binding"></span><h2>Catalog Binding<a class="headerlink" href="#catalog-binding" title="Permalink to this headline">¶</a></h2>
<p>A catalog is bound using the class constructor, given parameters
necessary for binding:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">deriva.core.ermrest_catalog</span> <span class="k">import</span> <span class="n">ErmrestCatalog</span>
<span class="kn">from</span> <span class="nn">deriva.core</span> <span class="k">import</span> <span class="n">get_credential</span>

<span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;https&quot;</span>
<span class="n">server</span> <span class="o">=</span> <span class="s2">&quot;myserver.example.com&quot;</span>
<span class="n">catalog_id</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
<span class="n">credentials</span> <span class="o">=</span> <span class="n">get_credential</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>

<span class="n">catalog</span> <span class="o">=</span> <span class="n">ErmrestCatalog</span><span class="p">(</span><span class="n">scheme</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">catalog_id</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="client-credentials">
<span id="client-credentials"></span><h2>Client Credentials<a class="headerlink" href="#client-credentials" title="Permalink to this headline">¶</a></h2>
<p>In the preceding example, a credential is obtained from the filesystem
assuming that the user has activated the <code class="docutils literal notranslate"><span class="pre">deriva-auth</span></code> authentication
agent prior to executing this code. For catalogs allowing anonymous
access, the optional <code class="docutils literal notranslate"><span class="pre">credentials</span></code> parameter can be omitted to
establish an anonymous binding.</p>
<p>The same client credentials (or anonymous access) is applied to all
HTTP operations performed by the subsequent calls to the catalog
object’s methods. If a calling program wishes to perform a mixture of
requests with different credentials, they should create multiple
catalog objects and choose the appropriate object for each request
scenario.</p>
</div>
<div class="section" id="high-level-api-factories">
<span id="high-level-api-factories"></span><h2>High-Level API Factories<a class="headerlink" href="#high-level-api-factories" title="Permalink to this headline">¶</a></h2>
<p>Several optional access APIs are layered on top of <code class="docutils literal notranslate"><span class="pre">ErmrestCatalog</span></code>
and/or <code class="docutils literal notranslate"><span class="pre">ErmrestSnapshot</span></code> and may be accessed by invoking convenient
factory methods on a catalog or snapshot object:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">catalog_snapshot</span> <span class="pre">=</span> <span class="pre">catalog.latest_snapshot()</span></code><ul>
<li><code class="docutils literal notranslate"><span class="pre">ErmrestSnapshot</span></code> binding for latest known revision of catalog</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">path_builder</span> <span class="pre">=</span> <span class="pre">catalog.getPathBuilder()</span></code><ul>
<li><code class="docutils literal notranslate"><span class="pre">deriva.core.datapath.Catalog</span></code> path builder for catalog (or snapshot)</li>
<li>Allows higher-level data access idioms as described previously.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">config_root</span> <span class="pre">=</span> <span class="pre">catalog.getCatalogConfig()</span></code><ul>
<li><code class="docutils literal notranslate"><span class="pre">deriva.core.ermrest_config.CatalogConfig</span></code> object for catalog (or snapshot)</li>
<li>The <code class="docutils literal notranslate"><span class="pre">config_root</span></code> object roots a tree of objects isomorphic to the catalog model, organizing configuration data according to each part of the model.</li>
<li>Allows inspection of catalog/snapshot annotations and policies.</li>
<li>Allows mutation to draft a new configuration objective.</li>
<li>Draft changes are applied with <code class="docutils literal notranslate"><span class="pre">catalog.applyCatalogConfig(config_root)</span></code></li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">model_root</span> <span class="pre">=</span> <span class="pre">catalog.getCatalogModel()</span></code><ul>
<li><code class="docutils literal notranslate"><span class="pre">deriva.core.ermrest_model.Model</span></code> object for catalog (or snapshot)</li>
<li>The <code class="docutils literal notranslate"><span class="pre">model_root</span></code> object roots a tree of objects isomorphic to the catalog model, organizing model definitions according to each part of the model.</li>
<li>Allows inspection of catalog/snapshot models (schemas, tables, columns, constraints)</li>
<li>Some model management idioms are exposed as methods on individual objects in the model hierarchy.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="low-level-http-methods">
<span id="low-level-http-methods"></span><h2>Low-Level HTTP Methods<a class="headerlink" href="#low-level-http-methods" title="Permalink to this headline">¶</a></h2>
<p>When the client understands the URL structuring conventions of
ERMrest, they can use basic Python Requests idioms on a catalog
instance:</p>
<ul class="simple">
<li>resp = catalog.get(path)</li>
<li>resp = catalog.delete(path)</li>
<li>resp = catalog.put(path, json=data)</li>
<li>resp = catalog.post(path, json=data)</li>
</ul>
<p>Unlike Python Requests, the <code class="docutils literal notranslate"><span class="pre">path</span></code> argument to each of these methods
should exclude the static prefix of the catalog itself. For example,
assuming <code class="docutils literal notranslate"><span class="pre">catalog</span></code> has been bound to
<code class="docutils literal notranslate"><span class="pre">https://myserver.example.com/ermrest/catalog/1</span></code> as in the constructor
example above, an attempt to access table content at
<code class="docutils literal notranslate"><span class="pre">https://myserver.example.com/ermrest/catalog/1/entity/MyTable</span></code> would
call <code class="docutils literal notranslate"><span class="pre">catalog.get(</span></code>/entity/MyTable`) and the catalog binding would
prepend the complete catalog prefix.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">json</span></code> input to the <code class="docutils literal notranslate"><span class="pre">catalog.put</span></code> and <code class="docutils literal notranslate"><span class="pre">catalog.post</span></code> methods
behaves just as in Python Requests. The data is supplied as native
Python lists, dictionaries, numbers, strings, and booleans. The method
implicitly serializes the data to JSON format and sets the appropriate
Content-Type header to inform the server we are sending JSON content.</p>
<p>All of these HTTP methods return a <code class="docutils literal notranslate"><span class="pre">requests.Response</span></code> object which
must be further interrogated to determine request status or to
retrieve any content produced by the server:</p>
<ul class="simple">
<li>resp.status_code: the HTTP response status code</li>
<li>resp.raise_for_status(): raise a Python exception for non-success codes</li>
<li>resp.json(): deserialize JSON content from server response</li>
<li>resp.headers: a dictionary of HTTP headers from the server response</li>
</ul>
<p>Low-level usage errors may raise exceptions directly from the HTTP
methods. However, normal server-indicated errors will produce a
response object and the caller must interrogate the <code class="docutils literal notranslate"><span class="pre">status_code</span></code>
field or use the <code class="docutils literal notranslate"><span class="pre">raise_for_status()</span></code> helper to determine whether the
request was successful.</p>
</div>
<div class="section" id="http-caching">
<span id="http-caching"></span><h2>HTTP Caching<a class="headerlink" href="#http-caching" title="Permalink to this headline">¶</a></h2>
<p>By default, the catalog binding uses HTTP caching for the
<code class="docutils literal notranslate"><span class="pre">catalog.get</span></code> method: it will store previous responses, include
appropriate <code class="docutils literal notranslate"><span class="pre">If-None-Match</span></code> headers in the new HTTP GET request,
detect <code class="docutils literal notranslate"><span class="pre">304</span> <span class="pre">Not</span> <span class="pre">Modified</span></code> responses indicating that cached content is
valid, and return the cached content to the caller. This mechanism can
be disabled by specifying <code class="docutils literal notranslate"><span class="pre">caching=False</span></code> in the ErmrestCatalog
constructor call.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api/deriva.html" class="btn btn-neutral float-right" title="deriva package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="deriva-py" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, USC Information Sciences Institute, Informatics Systems Research Division.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0-alpha',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>